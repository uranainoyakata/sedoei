<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ç”»åƒæš—è¨˜ã‚«ãƒ¼ãƒ‰</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            overscroll-behavior: contain; 
            -webkit-user-select: none;
            user-select: none;
        }
        .card-stack {
            perspective: 1000px;
        }
        .card {
            transform-style: preserve-3d;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .card.dragging {
            transition: none;
        }
        .card-shadow {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .gradient-overlay {
            background: linear-gradient(to top, 
                rgba(0,0,0,0.8) 0%, 
                rgba(0,0,0,0.4) 40%, 
                transparent 100%);
        }
        .like-indicator {
            background: linear-gradient(45deg, #10b981, #059669);
            transform: rotate(-30deg);
        }
        .nope-indicator {
            background: linear-gradient(45deg, #ef4444, #dc2626);
            transform: rotate(30deg);
        }
        .floating-button {
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
        }
        .floating-button:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-100 via-purple-50 to-indigo-100 min-h-screen overflow-hidden">

    <div class="flex flex-col h-screen max-w-sm mx-auto bg-white">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="bg-white shadow-sm px-6 py-4 flex-shrink-0">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-xl font-bold text-gray-800">æš—è¨˜ã‚«ãƒ¼ãƒ‰</h1>
                    <p class="text-xs text-gray-500">ã‚¹ãƒ¯ã‚¤ãƒ—ã—ã¦å­¦ç¿’ã—ã‚ˆã†</p>
                </div>
                <div class="text-2xl">ğŸ§ </div>
            </div>
        </header>

        <!-- ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠ -->
        <div class="px-6 py-3 bg-gray-50 flex-shrink-0">
            <select id="genre-select" class="w-full p-3 bg-white border border-gray-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition">
                <option value="">ã‚¸ãƒ£ãƒ³ãƒ«ã‚’é¸æŠ âœ¨</option>
            </select>
        </div>

        <!-- ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ãƒƒã‚¯ -->
        <div class="flex-1 relative overflow-hidden px-4 py-6 card-stack">
            <!-- èƒŒæ™¯ã‚«ãƒ¼ãƒ‰ï¼ˆæ¬¡ã®ã‚«ãƒ¼ãƒ‰ç”¨ï¼‰ -->
            <div class="absolute inset-4 bg-gray-100 rounded-3xl opacity-30"></div>
            <div class="absolute inset-4 bg-gray-200 rounded-3xl opacity-20 transform scale-95"></div>
            
            <!-- ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰ -->
            <div id="card-container" class="relative w-full h-full">
                <div id="image-card" class="absolute inset-0 bg-white rounded-3xl card-shadow card overflow-hidden cursor-grab active:cursor-grabbing">
                    
                    <!-- Like/Nope ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
                    <div id="like-indicator" class="absolute top-8 left-8 px-4 py-2 text-white font-bold text-lg like-indicator rounded-lg opacity-0 z-20">
                        è¦šãˆãŸ! âœ“
                    </div>
                    <div id="nope-indicator" class="absolute top-8 right-8 px-4 py-2 text-white font-bold text-lg nope-indicator rounded-lg opacity-0 z-20">
                        ã‚‚ã†ä¸€åº¦ â†»
                    </div>

                    <!-- ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ -->
                    <div id="no-image-placeholder" class="w-full h-full flex flex-col items-center justify-center">
                        <div class="text-8xl mb-6">ğŸ“š</div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2">å­¦ç¿’ã‚’å§‹ã‚ã‚ˆã†!</h3>
                        <p class="text-gray-500 text-center px-8 leading-relaxed">
                            ä¸Šã‹ã‚‰ã‚¸ãƒ£ãƒ³ãƒ«ã‚’é¸ã‚“ã§<br>
                            ç”»åƒæš—è¨˜ã‚«ãƒ¼ãƒ‰ã‚’é–‹å§‹
                        </p>
                    </div>

                    <!-- ç”»åƒ -->
                    <img id="image" src="" alt="æš—è¨˜ç”¨ã®ç”»åƒ" class="w-full h-full object-cover hidden">
                    
                    <!-- ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
                    <div id="overlay" class="absolute inset-0 gradient-overlay opacity-0 transition-opacity duration-500">
                        <div class="absolute bottom-8 left-6 right-6">
                            <div class="text-white">
                                <p class="text-lg font-semibold mb-2">ç­”ãˆãŒéš ã•ã‚Œã¦ã„ã¾ã™</p>
                                <p class="text-gray-200 text-sm">ã‚¿ãƒƒãƒ—ã§ç­”ãˆã‚’è¡¨ç¤º</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒœãƒˆãƒ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="flex-shrink-0 px-6 pb-8 pt-4">
            <div class="flex items-center justify-center space-x-4">
                <!-- ã‚„ã‚Šç›´ã—ãƒœã‚¿ãƒ³ -->
                <button id="nope-btn" class="w-14 h-14 bg-white rounded-full flex items-center justify-center floating-button border-2 border-red-200 disabled:opacity-30" disabled>
                    <span class="text-red-500 text-xl">â†»</span>
                </button>
                
                <!-- ç­”ãˆã‚’è¦‹ã‚‹ãƒœã‚¿ãƒ³ -->
                <button id="reveal-btn" class="flex-1 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold py-4 px-6 rounded-2xl floating-button disabled:opacity-30" disabled>
                    ç­”ãˆã‚’è¦‹ã‚‹ ğŸ‘ï¸
                </button>
                
                <!-- è¦šãˆãŸãƒœã‚¿ãƒ³ -->
                <button id="like-btn" class="w-14 h-14 bg-white rounded-full flex items-center justify-center floating-button border-2 border-green-200 disabled:opacity-30" disabled>
                    <span class="text-green-500 text-xl">âœ“</span>
                </button>
            </div>
            
            <div class="text-center mt-3">
                <p class="text-xs text-gray-400">â† ã‚‚ã†ä¸€åº¦ | è¦šãˆãŸ â†’</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ç”»åƒãƒ‡ãƒ¼ã‚¿è¨­å®š
            const imageData = {
                "GUCCIã‹ã°ã‚“": {
                    path: "images/gushikaban/",
                    count: 56,
                    extension: "jpeg"
                },
                "ç§‘å­¦": {
                    path: "images/science/",
                    count: 2,
                    extension: "png"
                },
                "ç¾è¡“": {
                    path: "images/art/",
                    count: 2,
                    extension: "jpg"
                }
            };

            // DOMè¦ç´ å–å¾—
            const genreSelect = document.getElementById('genre-select');
            const imageCard = document.getElementById('image-card');
            const imageElem = document.getElementById('image');
            const overlay = document.getElementById('overlay');
            const revealBtn = document.getElementById('reveal-btn');
            const likeBtn = document.getElementById('like-btn');
            const nopeBtn = document.getElementById('nope-btn');
            const placeholder = document.getElementById('no-image-placeholder');
            const likeIndicator = document.getElementById('like-indicator');
            const nopeIndicator = document.getElementById('nope-indicator');

            let currentGenreInfo = null;
            let lastImageNumber = -1;
            let isDragging = false;
            let startX = 0, startY = 0, currentX = 0, currentY = 0;

            // åˆæœŸçŠ¶æ…‹ã®è¨­å®š
            function showPlaceholder() {
                placeholder.classList.remove('hidden');
                imageElem.classList.add('hidden');
                overlay.style.opacity = '0';
                disableButtons();
            }

            function hidePlaceholder() {
                placeholder.classList.add('hidden');
                imageElem.classList.remove('hidden');
                enableButtons();
            }

            function enableButtons() {
                revealBtn.disabled = false;
                likeBtn.disabled = false;
                nopeBtn.disabled = false;
            }

            function disableButtons() {
                revealBtn.disabled = true;
                likeBtn.disabled = true;
                nopeBtn.disabled = true;
            }

            // ãƒ©ãƒ³ãƒ€ãƒ ç”»åƒèª­ã¿è¾¼ã¿
            function loadRandomImage() {
                if (!currentGenreInfo || currentGenreInfo.count === 0) {
                    showPlaceholder();
                    return;
                }

                let randomNum;
                if (currentGenreInfo.count > 1) {
                    do {
                        randomNum = Math.floor(Math.random() * currentGenreInfo.count) + 1;
                    } while (randomNum === lastImageNumber);
                } else {
                    randomNum = 1;
                }
                
                lastImageNumber = randomNum;
                const imagePath = `${currentGenreInfo.path}${randomNum}.${currentGenreInfo.extension}`;
                
                imageElem.src = imagePath;
                hidePlaceholder();
                overlay.style.opacity = '1';
                
                // ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ãƒªã‚»ãƒƒãƒˆ
                likeIndicator.style.opacity = '0';
                nopeIndicator.style.opacity = '0';
            }

            // ã‚«ãƒ¼ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            function animateCard(direction, callback) {
                const rotation = direction === 'right' ? 30 : -30;
                const translateX = direction === 'right' ? 400 : -400;
                
                imageCard.style.transition = 'transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                imageCard.style.transform = `translateX(${translateX}px) translateY(-50px) rotate(${rotation}deg) scale(0.8)`;
                
                setTimeout(() => {
                    imageCard.style.transition = 'transform 0.3s ease';
                    imageCard.style.transform = 'translateX(0) translateY(0) rotate(0deg) scale(1)';
                    if (callback) callback();
                }, 600);
            }

            // ã‚¸ãƒ£ãƒ³ãƒ«å¤‰æ›´
            function handleGenreChange() {
                const selectedGenre = genreSelect.value;
                if (!selectedGenre) {
                    currentGenreInfo = null;
                    showPlaceholder();
                    return;
                }
                currentGenreInfo = imageData[selectedGenre] || null;
                loadRandomImage();
            }

            // ãƒ‰ãƒ©ãƒƒã‚°å‡¦ç†
            function handleDragStart(e) {
                if (!currentGenreInfo) return;
                isDragging = true;
                startX = e.pageX || e.touches[0].pageX;
                startY = e.pageY || e.touches[0].pageY;
                imageCard.classList.add('dragging');
            }

            function handleDragMove(e) {
                if (!isDragging || !currentGenreInfo) return;
                e.preventDefault();
                
                currentX = e.pageX || e.touches[0].pageX;
                currentY = e.pageY || e.touches[0].pageY;
                
                const diffX = currentX - startX;
                const diffY = currentY - startY;
                const rotation = diffX / 10;
                
                imageCard.style.transform = `translateX(${diffX}px) translateY(${diffY}px) rotate(${rotation}deg)`;
                
                // ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼è¡¨ç¤º
                if (diffX > 50) {
                    likeIndicator.style.opacity = Math.min(1, (diffX - 50) / 100);
                    nopeIndicator.style.opacity = 0;
                } else if (diffX < -50) {
                    nopeIndicator.style.opacity = Math.min(1, (-diffX - 50) / 100);
                    likeIndicator.style.opacity = 0;
                } else {
                    likeIndicator.style.opacity = 0;
                    nopeIndicator.style.opacity = 0;
                }
            }

            function handleDragEnd() {
                if (!isDragging || !currentGenreInfo) return;
                isDragging = false;
                imageCard.classList.remove('dragging');
                
                const diffX = currentX - startX;
                const threshold = 120;
                
                if (Math.abs(diffX) > threshold) {
                    const direction = diffX > 0 ? 'right' : 'left';
                    animateCard(direction, loadRandomImage);
                } else {
                    imageCard.style.transform = 'translateX(0) translateY(0) rotate(0deg)';
                    likeIndicator.style.opacity = 0;
                    nopeIndicator.style.opacity = 0;
                }
            }

            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
            Object.keys(imageData).forEach(genre => {
                const option = document.createElement('option');
                option.value = genre;
                option.textContent = genre;
                genreSelect.appendChild(option);
            });

            genreSelect.addEventListener('change', handleGenreChange);
            
            revealBtn.addEventListener('click', () => {
                overlay.style.opacity = '0';
            });
            
            likeBtn.addEventListener('click', () => {
                if (currentGenreInfo) {
                    animateCard('right', loadRandomImage);
                }
            });
            
            nopeBtn.addEventListener('click', () => {
                if (currentGenreInfo) {
                    animateCard('left', loadRandomImage);
                }
            });

            // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆ
            imageCard.addEventListener('mousedown', handleDragStart);
            imageCard.addEventListener('mousemove', handleDragMove);
            imageCard.addEventListener('mouseup', handleDragEnd);
            imageCard.addEventListener('mouseleave', handleDragEnd);
            
            imageCard.addEventListener('touchstart', handleDragStart, { passive: true });
            imageCard.addEventListener('touchmove', handleDragMove, { passive: false });
            imageCard.addEventListener('touchend', handleDragEnd);

            // ç”»åƒã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
            imageElem.onerror = function() {
                console.error('ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', this.src);
                placeholder.innerHTML = `
                    <div class="text-8xl mb-6">âŒ</div>
                    <h3 class="text-xl font-semibold text-red-500 mb-2">èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</h3>
                    <p class="text-gray-500 text-center px-8">
                        ç”»åƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“<br>
                        ãƒ‘ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„
                    </p>
                `;
                showPlaceholder();
            };

            // åˆæœŸåŒ–
            showPlaceholder();
        });
    </script>
</body>
</html>
