<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>AI Flashcard Learner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      html, body, #root {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }
      html, body {
        overflow: hidden;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        overscroll-behavior: none;
        -webkit-user-select: none;
        user-select: none;
      }
      .card-stack {
        position: relative;
        width: 100%;
        height: 100%;
        perspective: 1000px;
      }
      .card {
        position: absolute;
        width: 100%;
        height: 100%;
        will-change: transform;
        backface-visibility: hidden;
        cursor: grab;
      }
      .floating-button {
          box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
          transition: transform 0.2s ease-in-out;
      }
      .floating-button:hover {
          transform: scale(1.05);
      }
      .floating-button:active {
          transform: scale(0.98);
      }
    </style>
    <!-- React Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX Transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-black">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useRef, useEffect, useCallback } = React;

        // --- Constants ---
        const IMAGE_DATA = {
            "GUCCI„Åã„Å∞„Çì": { path: "images/gushikaban/", count: 56, extension: "jpeg" },
            "„Ç∑„É£„Éç„É´„Åã„Å∞„Çì": { path: "images/nature/", count: 30, extension: "jpeg" },
            "„Éì„Éà„É≥„Åã„Å∞„Çì": { path: "images/cats/", count: 25, extension: "jpeg" },
            "Classic Cars": { path: "images/cars/", count: 18, extension: "jpeg" },
            "Space & Cosmos": { path: "images/space/", count: 22, extension: "jpeg" },
            "Ê≠¥Âè≤": { path: "images/history/", count: 15, extension: "jpeg" },
        };

        const getImagePath = (genreInfo, imageNumber) => {
            return `${genreInfo.path}${imageNumber}.${genreInfo.extension}`;
        };

        // --- Components ---
        const MenuIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
        );

        const Flashcard = ({
            imageSrc,
            isAnswerVisible,
            isPlaceholder,
            style,
            zIndex,
            eventHandlers,
        }) => {
            return (
                <div
                    className="card bg-gray-800 rounded-2xl shadow-xl overflow-hidden"
                    style={{ ...style, zIndex }}
                    {...eventHandlers}
                >
                    {isPlaceholder ? (
                        <div className="w-full h-full flex flex-col items-center justify-center text-white p-4">
                            <div className="text-8xl mb-6">üìö</div>
                            <h3 className="text-xl font-semibold text-gray-200 mb-2">Â≠¶Áøí„ÇíÂßã„ÇÅ„Çà„ÅÜ!</h3>
                            <p className="text-gray-400 text-center leading-relaxed">
                                Âè≥‰∏ä„ÅÆ„É°„Éã„É•„Éº„Åã„Çâ„Ç∏„É£„É≥„É´„ÇíÈÅ∏„Çì„Åß
                                <br />
                                ÊöóË®ò„Ç´„Éº„Éâ„ÇíÈñãÂßã
                            </p>
                        </div>
                    ) : (
                        <>
                            <img src={imageSrc} alt="Flashcard image" className="w-full h-full object-contain" />
                            <div 
                                className={`absolute bottom-0 left-0 right-0 h-1/4 transition-opacity duration-300 pointer-events-none ${isAnswerVisible ? 'opacity-0' : 'opacity-100'}`}
                            >
                                <div className="absolute inset-0 bg-black/50 backdrop-blur-md" />
                                <div className="relative w-full h-full flex items-center justify-center text-center p-4">
                                    <div>
                                        <p className="text-white text-lg font-bold"></p>
                                        <p className="text-gray-300 text-sm"></p>
                                    </div>
                                </div>
                            </div>
                        </>
                    )}
                </div>
            );
        };

        const GenreModal = ({ isOpen, onClose, onGenreSelect, genres }) => {
            if (!isOpen) {
                return null;
            }

            const handleSelectChange = (e) => {
                if (e.target.value) {
                    onGenreSelect(e.target.value);
                    onClose();
                }
            };

            return (
                <div 
                    className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-8 z-50 transition-opacity duration-300"
                    onClick={onClose}
                >
                    <div 
                        className="bg-white rounded-2xl shadow-xl w-full max-w-xs p-6"
                        onClick={(e) => e.stopPropagation()}
                    >
                        <h2 className="text-xl font-bold text-gray-800 mb-1">„Ç∏„É£„É≥„É´ÈÅ∏Êäû</h2>
                        <p className="text-sm text-gray-500 mb-6">Â≠¶Áøí„Åó„Åü„ÅÑ„Ç∏„É£„É≥„É´„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                        <select 
                            onChange={handleSelectChange}
                            defaultValue=""
                            className="w-full p-3 bg-gray-100 border border-gray-200 rounded-xl text-sm font-medium focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                        >
                            <option value="" disabled>„Ç∏„É£„É≥„É´„ÇíÈÅ∏Êäû ‚ú®</option>
                            {Object.keys(genres).map((genreName) => (
                                <option key={genreName} value={genreName}>{genreName}</option>
                            ))}
                        </select>
                        <button 
                            onClick={onClose}
                            className="mt-6 w-full bg-gray-200 text-gray-700 font-semibold py-3 px-6 rounded-xl transition hover:bg-gray-300"
                        >
                            Èñâ„Åò„Çã
                        </button>
                    </div>
                </div>
            );
        };
        
        // --- Hooks ---
        const useSwipe = (key, { onSwipeLeft, onSwipeRight, onSwipeMove }) => {
            const [style, setStyle] = useState({
                transform: 'translateX(0px) rotate(0deg)',
                transition: 'none',
            });
            const isSwiping = useRef(false);
            const startX = useRef(0);
            const currentX = useRef(0);
            
            useEffect(() => {
                setStyle({
                    transform: 'translateX(0px) rotate(0deg)',
                    transition: 'none',
                });
            }, [key]);

            const handleSwipeMoveInternal = useCallback((e) => {
                if (!isSwiping.current) return;
                
                if (e.cancelable) {
                    e.preventDefault();
                }

                currentX.current = e.touches ? e.touches[0].pageX : e.pageX;
                const diffX = currentX.current - startX.current;
                const rotation = diffX / 20;

                setStyle({
                    transform: `translateX(${diffX}px) rotate(${rotation}deg)`,
                    transition: 'none',
                });
                onSwipeMove?.(diffX);
            }, [onSwipeMove]);
            
            const handleSwipeEndInternal = useCallback(() => {
                if (!isSwiping.current) return;
                isSwiping.current = false;
                
                document.removeEventListener('mousemove', handleSwipeMoveInternal);
                document.removeEventListener('mouseup', handleSwipeEndInternal);
                document.removeEventListener('touchmove', handleSwipeMoveInternal);
                document.removeEventListener('touchend', handleSwipeEndInternal);

                const diffX = currentX.current - startX.current;
                const threshold = window.innerWidth / 4;

                if (Math.abs(diffX) < threshold) {
                    setStyle({
                        transform: 'translateX(0px) rotate(0deg)',
                        transition: 'transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1)',
                    });
                    onSwipeMove?.(0);
                    return;
                }

                const flyOutDirection = diffX > 0 ? 1 : -1;
                setStyle({
                    transform: `translateX(${flyOutDirection * window.innerWidth}px) rotate(${flyOutDirection * 30}deg)`,
                    transition: 'transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1)',
                });
                
                setTimeout(() => {
                    if (flyOutDirection < 0) {
                        onSwipeLeft();
                    } else {
                        onSwipeRight();
                    }
                }, 200);

            }, [handleSwipeMoveInternal, onSwipeLeft, onSwipeRight, onSwipeMove]);

            const handleSwipeStartInternal = useCallback((e) => {
                isSwiping.current = true;
                startX.current = e.touches ? e.touches[0].pageX : e.pageX;
                currentX.current = startX.current;

                document.addEventListener('mousemove', handleSwipeMoveInternal);
                document.addEventListener('mouseup', handleSwipeEndInternal);
                document.addEventListener('touchmove', handleSwipeMoveInternal, { passive: false });
                document.addEventListener('touchend', handleSwipeEndInternal);
            }, [handleSwipeMoveInternal, handleSwipeEndInternal]);

            return {
                style,
                eventHandlers: {
                    onMouseDown: handleSwipeStartInternal,
                    onTouchStart: handleSwipeStartInternal,
                },
            };
        };

        // --- Main App Component ---
        function App() {
            const [selectedGenre, setSelectedGenre] = useState(null);
            const [currentImageIndex, setCurrentImageIndex] = useState(1);
            const [isAnswerVisible, setIsAnswerVisible] = useState(false);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [swipeOffset, setSwipeOffset] = useState(0);

            const currentGenreInfo = selectedGenre ? IMAGE_DATA[selectedGenre] : null;

            const handleNextCard = () => {
                if (!currentGenreInfo) return;
                const nextIndex = (currentImageIndex % currentGenreInfo.count) + 1;
                setCurrentImageIndex(nextIndex);
                setIsAnswerVisible(false);
                setSwipeOffset(0);
            };
            
            const swipeKey = `${selectedGenre}-${currentImageIndex}`;
            const { style: swipeStyle, eventHandlers } = useSwipe(swipeKey, {
                onSwipeLeft: handleNextCard,
                onSwipeRight: handleNextCard,
                onSwipeMove: setSwipeOffset,
            });

            const handleGenreSelect = (genre) => {
                setSelectedGenre(genre);
                setCurrentImageIndex(1);
                setIsAnswerVisible(false);
                setSwipeOffset(0);
            };

            const currentImageSrc = useMemo(() => {
                if (!currentGenreInfo) return undefined;
                return getImagePath(currentGenreInfo, currentImageIndex);
            }, [currentGenreInfo, currentImageIndex]);
            
            const nextImageSrc = useMemo(() => {
                if (!currentGenreInfo) return undefined;
                const nextIndex = (currentImageIndex % currentGenreInfo.count) + 1;
                return getImagePath(currentGenreInfo, nextIndex);
            }, [currentGenreInfo, currentImageIndex]);

            const behindCardStyle = useMemo(() => {
                const isSwiping = swipeOffset !== 0;
                const swipeProgress = Math.min(Math.abs(swipeOffset) / (window.innerWidth / 4), 1);
                const scale = 0.95 + (0.05 * swipeProgress);
                const translateY = 20 - (20 * swipeProgress);

                return {
                    transform: `translateY(${translateY}px) scale(${scale})`,
                    transition: isSwiping ? 'none' : 'transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1)',
                    zIndex: 1
                };
            }, [swipeOffset]);


            return (
                <div className="relative w-screen h-[100dvh] max-w-sm mx-auto bg-black overflow-hidden">
                    <div className="absolute inset-x-4 inset-y-16 card-stack">
                        {/* Behind Card */}
                        {selectedGenre && (
                             <Flashcard
                                isPlaceholder={false}
                                imageSrc={nextImageSrc}
                                isAnswerVisible={false}
                                style={behindCardStyle}
                            />
                        )}
                        
                        {/* Main Card */}
                        <Flashcard
                            isPlaceholder={!selectedGenre}
                            imageSrc={currentImageSrc}
                            isAnswerVisible={isAnswerVisible}
                            style={swipeStyle}
                            zIndex={2}
                            eventHandlers={currentGenreInfo ? eventHandlers : undefined}
                        />
                    </div>

                    {/* Floating UI */}
                    <div className="absolute top-4 right-4 z-30">
                        <button
                            onClick={() => setIsModalOpen(true)}
                            className="w-12 h-12 bg-black/30 backdrop-blur-md text-white rounded-full flex items-center justify-center floating-button"
                            aria-label="Open genre menu"
                        >
                            <MenuIcon className="w-6 h-6" />
                        </button>
                    </div>

                    <div className="absolute bottom-0 left-0 right-0 flex justify-center z-30" style={{ paddingBottom: 'calc(1.5rem + env(safe-area-inset-bottom))' }}>
                        <button
                            id="reveal-btn"
                            onClick={() => setIsAnswerVisible(v => !v)}
                            disabled={!selectedGenre}
                            className="bg-gradient-to-r from-blue-500 to-purple-500 text-white font-semibold py-3 px-5 rounded-full floating-button disabled:opacity-30 disabled:cursor-not-allowed flex items-center gap-2"
                        >
                            <span>{isAnswerVisible ? '‚úÖ' : 'üëÅÔ∏è'}</span>
                            <span>{isAnswerVisible ? 'Èö†„Åô' : 'Á≠î„Åà„ÇíË¶ã„Çã'}</span>
                        </button>
                    </div>

                    <GenreModal
                        isOpen={isModalOpen}
                        onClose={() => setIsModalOpen(false)}
                        onGenreSelect={handleGenreSelect}
                        genres={IMAGE_DATA}
                    />
                </div>
            );
        }

        // --- Mount Application ---
        const rootElement = document.getElementById('root');
        const root = ReactDOM.createRoot(rootElement);
        root.render(
          <React.StrictMode>
            <App />
          </React.StrictMode>
        );
    </script>
</body>
</html>
